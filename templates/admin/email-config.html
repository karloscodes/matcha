<!DOCTYPE html>
<html>

<head>
  <title>Email Configuration - License Key Manager</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#6b7280',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            info: '#06b6d4'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-50 min-h-screen">
  <nav class="bg-gray-900 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <a href="/admin" class="text-white text-lg font-semibold">
            License Key Manager
          </a>
        </div>

        <div class="relative">
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown()"
              class="flex items-center text-white hover:text-gray-300 focus:outline-none focus:text-gray-300">
              <span class="mr-2">Admin</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>

            <div id="dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
              <a href="/admin" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Dashboard</a>
              <a href="/admin/products" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Products</a>
              <a href="/admin/customers" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Customers</a>
              <a href="/admin/license-keys" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">License
                Keys</a>
              <hr class="my-1">
              <a href="/admin/email-config"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 bg-gray-50">Settings</a>
              <hr class="my-1">
              <a href="/admin/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Email Configuration</h1>
      <p class="mt-2 text-sm text-gray-600">Configure email delivery settings for license key notifications.</p>
    </div>

    {{if .Error}}
    <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
      <span class="block sm:inline">{{.Error}}</span>
    </div>
    {{end}}

    {{if .Success}}
    <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
      <span class="block sm:inline">{{.Success}}</span>
    </div>
    {{end}}

    <div class="bg-white shadow rounded-lg">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900">Email Provider Configuration</h2>
      </div>

      <form method="POST" action="/admin/email-config" class="px-6 py-6">
        <input type="hidden" name="_token" value="{{.CSRFToken}}">
        <div class="space-y-6">
          <!-- Email Service Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">Email Service Provider</label>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
              <div class="relative">
                <input type="radio" name="email_service" value="smtp" id="smtp" {{if eq .Config.EmailService "smtp"
                  }}checked{{end}} class="sr-only peer" onchange="showProvider('smtp')">
                <label for="smtp"
                  class="flex p-4 bg-white border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 peer-checked:border-blue-500 peer-checked:bg-blue-50">
                  <div class="block">
                    <div class="w-full text-lg font-semibold">SMTP</div>
                    <div class="w-full text-sm text-gray-500">Custom SMTP server</div>
                  </div>
                </label>
              </div>

              <div class="relative">
                <input type="radio" name="email_service" value="mailgun" id="mailgun" {{if eq
                  .Config.EmailService "mailgun" }}checked{{end}} class="sr-only peer"
                  onchange="showProvider('mailgun')">
                <label for="mailgun"
                  class="flex p-4 bg-white border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 peer-checked:border-blue-500 peer-checked:bg-blue-50">
                  <div class="block">
                    <div class="w-full text-lg font-semibold">Mailgun</div>
                    <div class="w-full text-sm text-gray-500">Mailgun API</div>
                  </div>
                </label>
              </div>

              <div class="relative">
                <input type="radio" name="email_service" value="sendgrid" id="sendgrid" {{if eq
                  .Config.EmailService "sendgrid" }}checked{{end}} class="sr-only peer"
                  onchange="showProvider('sendgrid')">
                <label for="sendgrid"
                  class="flex p-4 bg-white border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 peer-checked:border-blue-500 peer-checked:bg-blue-50">
                  <div class="block">
                    <div class="w-full text-lg font-semibold">SendGrid</div>
                    <div class="w-full text-sm text-gray-500">SendGrid API</div>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Common Settings -->
          <div>
            <label for="from_email" class="block text-sm font-medium text-gray-700">From Email Address</label>
            <input type="email" name="from_email" id="from_email" required
              class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
              placeholder="noreply@yourdomain.com" value="{{.Config.FromEmail}}">
            <p class="mt-1 text-sm text-gray-500">The email address that license key emails will be sent from</p>
          </div>

          <!-- SMTP Settings -->
          <div id="smtp-settings" class="space-y-4 p-4 bg-gray-50 rounded-lg"
            style="display: {{if eq .Config.EmailService " smtp"}}block{{else}}none{{end}}">
            <h3 class="text-md font-medium text-gray-900">SMTP Configuration</h3>

            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label for="smtp_server" class="block text-sm font-medium text-gray-700">SMTP Server</label>
                <input type="text" name="smtp_server" id="smtp_server"
                  class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                  placeholder="smtp.gmail.com" value="{{.Config.SMTPServer}}">
              </div>

              <div>
                <label for="smtp_port" class="block text-sm font-medium text-gray-700">SMTP Port</label>
                <input type="number" name="smtp_port" id="smtp_port"
                  class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                  placeholder="587" value="{{.Config.SMTPPort}}">
              </div>
            </div>

            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label for="smtp_username" class="block text-sm font-medium text-gray-700">Username</label>
                <input type="text" name="smtp_username" id="smtp_username"
                  class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                  placeholder="your-email@gmail.com" value="{{.Config.SMTPUsername}}">
              </div>

              <div>
                <label for="smtp_password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" name="smtp_password" id="smtp_password"
                  class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                  placeholder="your-app-password" value="{{.Config.SMTPPassword}}">
              </div>
            </div>

            <div class="flex items-center">
              <input type="checkbox" name="smtp_tls" id="smtp_tls" {{if eq .Config.SMTPTLS "true" }}checked{{end}}
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <label for="smtp_tls" class="ml-2 block text-sm text-gray-900">Use TLS encryption</label>
            </div>
          </div>

          <!-- Mailgun Settings -->
          <div id="mailgun-settings" class="space-y-4 p-4 bg-gray-50 rounded-lg"
            style="display: {{if eq .Config.EmailService " mailgun"}}block{{else}}none{{end}}">
            <h3 class="text-md font-medium text-gray-900">Mailgun Configuration</h3>

            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label for="mailgun_domain" class="block text-sm font-medium text-gray-700">Mailgun Domain</label>
                <input type="text" name="mailgun_domain" id="mailgun_domain"
                  class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                  placeholder="mg.yourdomain.com" value="{{.Config.MailgunDomain}}">
              </div>

              <div>
                <label for="mailgun_api_key" class="block text-sm font-medium text-gray-700">API Key</label>
                <input type="password" name="mailgun_api_key" id="mailgun_api_key"
                  class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                  placeholder="key-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" value="{{.Config.MailgunAPIKey}}">
              </div>
            </div>
          </div>

          <!-- SendGrid Settings -->
          <div id="sendgrid-settings" class="space-y-4 p-4 bg-gray-50 rounded-lg"
            style="display: {{if eq .Config.EmailService " sendgrid"}}block{{else}}none{{end}}">
            <h3 class="text-md font-medium text-gray-900">SendGrid Configuration</h3>

            <div>
              <label for="sendgrid_api_key" class="block text-sm font-medium text-gray-700">SendGrid API Key</label>
              <input type="password" name="sendgrid_api_key" id="sendgrid_api_key"
                class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                placeholder="SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" value="{{.Config.SendGridAPIKey}}">
            </div>
          </div>

          <!-- Save Button -->
          <div class="flex justify-end">
            <button type="submit"
              class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Save Configuration
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Test Email Section -->
    <div class="mt-8 bg-white shadow rounded-lg">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900">Test Email Delivery</h2>
        <p class="mt-1 text-sm text-gray-500">Send a test email to verify your configuration</p>
      </div>

      <form method="POST" action="/admin/email-config/test" class="px-6 py-6">
        <input type="hidden" name="_token" value="{{.CSRFToken}}">
        <div class="flex gap-4">
          <div class="flex-1">
            <label for="test_email" class="block text-sm font-medium text-gray-700">Test Email Address</label>
            <input type="email" name="test_email" id="test_email" required
              class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
              placeholder="test@example.com">
          </div>
          <div class="flex items-end">
            <button type="submit"
              class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Send Test Email
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    function toggleDropdown() {
      const dropdown = document.getElementById('dropdown');
      dropdown.classList.toggle('hidden');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function (event) {
      const dropdown = document.getElementById('dropdown');
      const button = event.target.closest('button');

      if (!button && dropdown && !dropdown.classList.contains('hidden')) {
        dropdown.classList.add('hidden');
      }
    });

    function showProvider(provider) {
      // Hide all provider sections
      document.getElementById('smtp-settings').style.display = 'none';
      document.getElementById('mailgun-settings').style.display = 'none';
      document.getElementById('sendgrid-settings').style.display = 'none';

      // Show selected provider section
      document.getElementById(provider + '-settings').style.display = 'block';
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function () {
      const selectedProvider = document.querySelector('input[name="email_service"]:checked');
      if (selectedProvider) {
        showProvider(selectedProvider.value);
      } else {
        // Default to SMTP if no provider is selected
        showProvider('smtp');
      }
    });
  </script>
</body>

</html>
